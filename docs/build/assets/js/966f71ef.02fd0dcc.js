"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[339],{824(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"data/tanstack-query","title":"TanStack Query","description":"Purpose","source":"@site/docs/data/tanstack-query.md","sourceDirName":"data","slug":"/data/tanstack-query","permalink":"/docs/data/tanstack-query","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"TanStack Query"},"sidebar":"tutorialSidebar","previous":{"title":"API Routes","permalink":"/docs/data/api-routes"},"next":{"title":"Database Queries","permalink":"/docs/data/database-queries"}}');var t=s(2540),a=s(3023);const i={title:"TanStack Query"},l="TanStack Query (React Query)",c={},d=[{value:"Purpose",id:"purpose",level:2},{value:"Why Use TanStack Query?",id:"why-use-tanstack-query",level:2},{value:"Benefits",id:"benefits",level:3},{value:"When to Use",id:"when-to-use",level:2},{value:"\u2705 Use TanStack Query For:",id:"-use-tanstack-query-for",level:3},{value:"\u274c Don&#39;t Use TanStack Query For:",id:"-dont-use-tanstack-query-for",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"1. User Dashboard with Live Data",id:"1-user-dashboard-with-live-data",level:3},{value:"2. Social Media Feed with Optimistic Updates",id:"2-social-media-feed-with-optimistic-updates",level:3},{value:"3. Infinite Scroll Product List",id:"3-infinite-scroll-product-list",level:3},{value:"Core Concepts",id:"core-concepts",level:2},{value:"QueryKey",id:"querykey",level:3},{value:"QueryFn",id:"queryfn",level:3},{value:"Stale Time",id:"stale-time",level:3},{value:"Cache Time (gcTime)",id:"cache-time-gctime",level:3},{value:"Key Hooks",id:"key-hooks",level:2},{value:"useQuery - Data Fetching",id:"usequery---data-fetching",level:3},{value:"useMutation - Data Updates",id:"usemutation---data-updates",level:3},{value:"useInfiniteQuery - Pagination",id:"useinfinitequery---pagination",level:3},{value:"Caching Strategies",id:"caching-strategies",level:2},{value:"1. Stale While Revalidate",id:"1-stale-while-revalidate",level:3},{value:"2. Polling/Refetching",id:"2-pollingrefetching",level:3},{value:"3. Manual Refetch",id:"3-manual-refetch",level:3},{value:"Comparison",id:"comparison",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Advanced Patterns",id:"advanced-patterns",level:2},{value:"Dependent Queries",id:"dependent-queries",level:3},{value:"Parallel Queries",id:"parallel-queries",level:3},{value:"Query Cancellation",id:"query-cancellation",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"Learn More",id:"learn-more",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"tanstack-query-react-query",children:"TanStack Query (React Query)"})}),"\n",(0,t.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,t.jsx)(n.p,{children:"TanStack Query is a powerful data fetching and caching library for React applications. It manages server state, providing automatic caching, background refetching, and optimistic updates."}),"\n",(0,t.jsx)(n.h2,{id:"why-use-tanstack-query",children:"Why Use TanStack Query?"}),"\n",(0,t.jsx)(n.h3,{id:"benefits",children:"Benefits"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatic Caching"}),": Smart caching with configurable strategies"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Background Refetching"}),": Keep data fresh automatically"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Optimistic Updates"}),": Update UI before server responds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Retry Logic"}),": Automatic retries on failure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Loading/Error States"}),": Built-in state management"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pagination/Infinite Scroll"}),": First-class support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Devtools"}),": Powerful debugging tools"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,t.jsx)(n.h3,{id:"-use-tanstack-query-for",children:"\u2705 Use TanStack Query For:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client-Side Data Fetching"}),": Fetching data in Client Components"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Real-time Data"}),": Data that changes frequently"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"User-Specific Data"}),": Data based on user interactions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Infinite Scroll"}),": Paginated data loading"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mutations with Optimistic Updates"}),": Like buttons, favorites"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Complex Caching"}),": When you need fine-grained cache control"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API Integrations"}),": REST APIs, GraphQL endpoints"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"-dont-use-tanstack-query-for",children:"\u274c Don't Use TanStack Query For:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Initial Page Data"}),": Use Server Components for SSR"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Static Data"}),": Data that rarely changes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Simple Forms"}),": Use Server Actions for simpler mutations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"SEO-Critical Content"}),": Use Server Components for better SEO"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsx)(n.h3,{id:"1-user-dashboard-with-live-data",children:"1. User Dashboard with Live Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"'use client'\r\nimport { useQuery } from '@tanstack/react-query'\r\n\r\nexport default function Dashboard() {\r\n  const { data, isLoading, error } = useQuery({\r\n    queryKey: ['dashboard'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/dashboard')\r\n      return res.json()\r\n    },\r\n    refetchInterval: 30000, // Refetch every 30 seconds\r\n  })\r\n  \r\n  if (isLoading) return <Skeleton />\r\n  if (error) return <Error />\r\n  return <DashboardView data={data} />\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-social-media-feed-with-optimistic-updates",children:"2. Social Media Feed with Optimistic Updates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { mutate } = useMutation({\r\n  mutationFn: (postId) => fetch(`/api/posts/${postId}/like`, { method: 'POST' }),\r\n  onMutate: async (postId) => {\r\n    // Optimistically update UI\r\n    await queryClient.cancelQueries({ queryKey: ['posts'] })\r\n    const previousPosts = queryClient.getQueryData(['posts'])\r\n    \r\n    queryClient.setQueryData(['posts'], (old) =>\r\n      old.map(post =>\r\n        post.id === postId ? { ...post, likes: post.likes + 1 } : post\r\n      )\r\n    )\r\n    \r\n    return { previousPosts }\r\n  },\r\n  onError: (err, postId, context) => {\r\n    // Rollback on error\r\n    queryClient.setQueryData(['posts'], context.previousPosts)\r\n  },\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-infinite-scroll-product-list",children:"3. Infinite Scroll Product List"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const {\r\n  data,\r\n  fetchNextPage,\r\n  hasNextPage,\r\n  isFetchingNextPage\r\n} = useInfiniteQuery({\r\n  queryKey: ['products'],\r\n  queryFn: ({ pageParam = 0 }) =>\r\n    fetch(`/api/products?page=${pageParam}`).then(res => res.json()),\r\n  getNextPageParam: (lastPage) => lastPage.nextPage,\r\n})\n"})}),"\n",(0,t.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,t.jsx)(n.h3,{id:"querykey",children:"QueryKey"}),"\n",(0,t.jsx)(n.p,{children:"Unique identifier for cached data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"queryKey: ['posts'] // All posts\r\nqueryKey: ['posts', postId] // Specific post\r\nqueryKey: ['posts', { status: 'published' }] // Filtered posts\n"})}),"\n",(0,t.jsx)(n.h3,{id:"queryfn",children:"QueryFn"}),"\n",(0,t.jsx)(n.p,{children:"Function that fetches your data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"queryFn: async () => {\r\n  const response = await fetch('/api/data')\r\n  if (!response.ok) throw new Error('Failed')\r\n  return response.json()\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"stale-time",children:"Stale Time"}),"\n",(0,t.jsx)(n.p,{children:"How long data is considered fresh:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"staleTime: 5 * 60 * 1000 // 5 minutes\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cache-time-gctime",children:"Cache Time (gcTime)"}),"\n",(0,t.jsx)(n.p,{children:"How long unused data stays in cache:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"gcTime: 10 * 60 * 1000 // 10 minutes\n"})}),"\n",(0,t.jsx)(n.h2,{id:"key-hooks",children:"Key Hooks"}),"\n",(0,t.jsx)(n.h3,{id:"usequery---data-fetching",children:"useQuery - Data Fetching"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { data, isLoading, error, refetch } = useQuery({\r\n  queryKey: ['todos'],\r\n  queryFn: fetchTodos,\r\n  staleTime: 60000,\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usemutation---data-updates",children:"useMutation - Data Updates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const mutation = useMutation({\r\n  mutationFn: createTodo,\r\n  onSuccess: () => {\r\n    queryClient.invalidateQueries({ queryKey: ['todos'] })\r\n  },\r\n})\r\n\r\nmutation.mutate({ title: 'New Todo' })\n"})}),"\n",(0,t.jsx)(n.h3,{id:"useinfinitequery---pagination",children:"useInfiniteQuery - Pagination"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const {\r\n  data,\r\n  fetchNextPage,\r\n  hasNextPage\r\n} = useInfiniteQuery({\r\n  queryKey: ['posts'],\r\n  queryFn: fetchPosts,\r\n  getNextPageParam: (lastPage) => lastPage.nextCursor,\r\n})\n"})}),"\n",(0,t.jsx)(n.h2,{id:"caching-strategies",children:"Caching Strategies"}),"\n",(0,t.jsx)(n.h3,{id:"1-stale-while-revalidate",children:"1. Stale While Revalidate"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"useQuery({\r\n  queryKey: ['data'],\r\n  queryFn: fetchData,\r\n  staleTime: 5 * 60 * 1000, // 5 min fresh\r\n  gcTime: 10 * 60 * 1000, // 10 min in cache\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-pollingrefetching",children:"2. Polling/Refetching"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"useQuery({\r\n  queryKey: ['data'],\r\n  queryFn: fetchData,\r\n  refetchInterval: 30000, // Every 30 seconds\r\n  refetchOnWindowFocus: true, // On tab focus\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-manual-refetch",children:"3. Manual Refetch"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { refetch } = useQuery({ queryKey: ['data'], queryFn: fetchData })\r\n\r\n<button onClick={() => refetch()}>Refresh</button>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"comparison",children:"Comparison"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"TanStack Query"}),(0,t.jsx)(n.th,{children:"Server Components"}),(0,t.jsx)(n.th,{children:"useState + useEffect"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Caching"}),(0,t.jsx)(n.td,{children:"\u2705 Automatic"}),(0,t.jsx)(n.td,{children:"\u2705 Built-in"}),(0,t.jsx)(n.td,{children:"\u274c Manual"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Loading States"}),(0,t.jsx)(n.td,{children:"\u2705 Built-in"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Suspense"}),(0,t.jsx)(n.td,{children:"\u274c Manual"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Refetching"}),(0,t.jsx)(n.td,{children:"\u2705 Automatic"}),(0,t.jsx)(n.td,{children:"\u274c On navigation"}),(0,t.jsx)(n.td,{children:"\u274c Manual"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Optimistic Updates"}),(0,t.jsx)(n.td,{children:"\u2705 Built-in"}),(0,t.jsx)(n.td,{children:"\u274c Complex"}),(0,t.jsx)(n.td,{children:"\u274c Complex"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SSR"}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Requires setup"}),(0,t.jsx)(n.td,{children:"\u2705 Native"}),(0,t.jsx)(n.td,{children:"\u274c No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Client-side"}),(0,t.jsx)(n.td,{children:"\u2705 Perfect"}),(0,t.jsx)(n.td,{children:"\u274c Server-only"}),(0,t.jsx)(n.td,{children:"\u2705 Yes"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use Query Keys Wisely"}),": Create consistent, hierarchical query keys"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"['users'] // All users\r\n['users', userId] // Single user\r\n['users', userId, 'posts'] // User's posts\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set Appropriate Stale Times"}),": Balance freshness and performance"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"staleTime: 0, // Always refetch (live data)\r\nstaleTime: 30000, // 30 seconds (frequently changing)\r\nstaleTime: 5 * 60 * 1000, // 5 minutes (stable data)\r\nstaleTime: Infinity, // Never stale (static data)\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Invalidate on Mutations"}),": Keep data in sync"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"onSuccess: () => {\r\n  queryClient.invalidateQueries({ queryKey: ['users'] })\r\n}\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use Optimistic Updates"}),": Better UX for mutations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Enable Devtools"}),": Use React Query Devtools in development"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle Errors Gracefully"}),": Show meaningful error messages"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prefetch Data"}),": Prefetch data for better UX"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"await queryClient.prefetchQuery({ queryKey: ['post', id], queryFn: fetchPost })\n"})}),"\n",(0,t.jsx)(n.h2,{id:"advanced-patterns",children:"Advanced Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"dependent-queries",children:"Dependent Queries"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const { data: user } = useQuery({ queryKey: ['user'], queryFn: fetchUser })\r\n\r\nconst { data: posts } = useQuery({\r\n  queryKey: ['posts', user?.id],\r\n  queryFn: () => fetchUserPosts(user.id),\r\n  enabled: !!user, // Only run when user exists\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"parallel-queries",children:"Parallel Queries"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"const users = useQuery({ queryKey: ['users'], queryFn: fetchUsers })\r\nconst posts = useQuery({ queryKey: ['posts'], queryFn: fetchPosts })\r\nconst comments = useQuery({ queryKey: ['comments'], queryFn: fetchComments })\n"})}),"\n",(0,t.jsx)(n.h3,{id:"query-cancellation",children:"Query Cancellation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"queryFn: async ({ signal }) => {\r\n  const response = await fetch('/api/data', { signal })\r\n  return response.json()\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Select Transformations"}),": Transform data efficiently"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"useQuery({\r\n  queryKey: ['todos'],\r\n  queryFn: fetchTodos,\r\n  select: (data) => data.filter(todo => !todo.completed),\r\n})\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Structural Sharing"}),": Automatically prevents unnecessary re-renders"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Query Splitting"}),": Split large queries into smaller ones"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Disable Queries"}),": Disable queries when not needed"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"enabled: isAuthenticated && userId !== null\n"})}),"\n",(0,t.jsx)(n.h2,{id:"learn-more",children:"Learn More"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tanstack.com/query/latest",children:"TanStack Query Docs"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://tanstack.com/query/latest/docs/devtools",children:"TanStack Query Devtools"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},3023(e,n,s){s.d(n,{R:()=>i,x:()=>l});var r=s(3696);const t={},a=r.createContext(t);function i(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);