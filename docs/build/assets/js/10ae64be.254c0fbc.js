"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[15],{3023(e,n,r){r.d(n,{R:()=>i,x:()=>a});var s=r(3696);const t={},o=s.createContext(t);function i(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},9818(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"data/api-routes","title":"API Routes","description":"Purpose","source":"@site/docs/data/api-routes.md","sourceDirName":"data","slug":"/data/api-routes","permalink":"/docs/data/api-routes","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"API Routes"},"sidebar":"tutorialSidebar","previous":{"title":"Server Actions","permalink":"/docs/data/server-actions"},"next":{"title":"TanStack Query","permalink":"/docs/data/tanstack-query"}}');var t=r(2540),o=r(3023);const i={title:"API Routes"},a="API Routes",d={},l=[{value:"Purpose",id:"purpose",level:2},{value:"Why Use API Routes?",id:"why-use-api-routes",level:2},{value:"Benefits",id:"benefits",level:3},{value:"When to Use",id:"when-to-use",level:2},{value:"\u2705 Use API Routes For:",id:"-use-api-routes-for",level:3},{value:"\u274c Don&#39;t Use API Routes For:",id:"-dont-use-api-routes-for",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"1. External API Proxy",id:"1-external-api-proxy",level:3},{value:"2. CRUD Operations",id:"2-crud-operations",level:3},{value:"3. Webhook Handler",id:"3-webhook-handler",level:3},{value:"HTTP Methods",id:"http-methods",level:2},{value:"Request Handling",id:"request-handling",level:2},{value:"Reading Query Parameters",id:"reading-query-parameters",level:3},{value:"Reading Request Body",id:"reading-request-body",level:3},{value:"Reading Headers",id:"reading-headers",level:3},{value:"Reading Cookies",id:"reading-cookies",level:3},{value:"Response Handling",id:"response-handling",level:2},{value:"JSON Response",id:"json-response",level:3},{value:"Response with Status Code",id:"response-with-status-code",level:3},{value:"Response with Headers",id:"response-with-headers",level:3},{value:"Set Cookies",id:"set-cookies",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Authentication",id:"authentication",level:2},{value:"CORS Configuration",id:"cors-configuration",level:2},{value:"Edge Runtime",id:"edge-runtime",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Comparison",id:"comparison",level:2},{value:"Learn More",id:"learn-more",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"api-routes",children:"API Routes"})}),"\n",(0,t.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,t.jsx)(n.p,{children:"API Routes in Next.js allow you to build RESTful API endpoints within your Next.js application. They run server-side and can handle HTTP methods like GET, POST, PUT, DELETE, etc."}),"\n",(0,t.jsx)(n.h2,{id:"why-use-api-routes",children:"Why Use API Routes?"}),"\n",(0,t.jsx)(n.h3,{id:"benefits",children:"Benefits"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Full-Stack in One App"}),": Build backend and frontend together"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TypeScript Support"}),": Share types between frontend and API"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Serverless by Default"}),": Deploy as serverless functions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Edge Runtime"}),": Run at the edge for lower latency"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No CORS Issues"}),": Same origin as your frontend"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Easy Authentication"}),": Use middleware for auth"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,t.jsx)(n.h3,{id:"-use-api-routes-for",children:"\u2705 Use API Routes For:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"External API Integration"}),": Proxy requests to third-party APIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Webhooks"}),": Handle webhook callbacks from services"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Complex Business Logic"}),": Operations requiring multiple steps"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Public APIs"}),": Build REST or GraphQL APIs for mobile apps"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"File Uploads"}),": Handle multipart form data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate Limiting"}),": Implement custom rate limiting logic"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication Endpoints"}),": Login, signup, token refresh"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"-dont-use-api-routes-for",children:"\u274c Don't Use API Routes For:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Simple Form Submissions"}),": Use Server Actions instead"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Internal Data Fetching"}),": Use Server Components directly"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Real-time Communication"}),": Use WebSockets or Server-Sent Events"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsx)(n.h3,{id:"1-external-api-proxy",children:"1. External API Proxy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// app/api/weather/route.ts\r\nexport async function GET(request: Request) {\r\n  const { searchParams } = new URL(request.url)\r\n  const city = searchParams.get('city')\r\n  \r\n  const response = await fetch(\r\n    `https://api.weather.com/v1/weather?city=${city}&key=${process.env.WEATHER_API_KEY}`\r\n  )\r\n  const data = await response.json()\r\n  \r\n  return Response.json(data)\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-crud-operations",children:"2. CRUD Operations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// app/api/posts/route.ts\r\nexport async function GET() {\r\n  const posts = await db.post.findMany()\r\n  return Response.json(posts)\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  const body = await request.json()\r\n  const post = await db.post.create({ data: body })\r\n  return Response.json(post, { status: 201 })\r\n}\r\n\r\n// app/api/posts/[id]/route.ts\r\nexport async function PUT(\r\n  request: Request,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  const body = await request.json()\r\n  const post = await db.post.update({\r\n    where: { id: params.id },\r\n    data: body\r\n  })\r\n  return Response.json(post)\r\n}\r\n\r\nexport async function DELETE(\r\n  request: Request,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  await db.post.delete({ where: { id: params.id } })\r\n  return new Response(null, { status: 204 })\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-webhook-handler",children:"3. Webhook Handler"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"// app/api/webhooks/stripe/route.ts\r\nimport { headers } from 'next/headers'\r\nimport Stripe from 'stripe'\r\n\r\nexport async function POST(request: Request) {\r\n  const body = await request.text()\r\n  const signature = headers().get('stripe-signature')!\r\n  \r\n  const event = stripe.webhooks.constructEvent(\r\n    body,\r\n    signature,\r\n    process.env.STRIPE_WEBHOOK_SECRET!\r\n  )\r\n  \r\n  if (event.type === 'checkout.session.completed') {\r\n    const session = event.data.object\r\n    // Handle successful payment\r\n  }\r\n  \r\n  return Response.json({ received: true })\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"http-methods",children:"HTTP Methods"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export async function GET(request: Request) {\r\n  // Handle GET requests\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  // Handle POST requests\r\n}\r\n\r\nexport async function PUT(request: Request) {\r\n  // Handle PUT requests\r\n}\r\n\r\nexport async function PATCH(request: Request) {\r\n  // Handle PATCH requests\r\n}\r\n\r\nexport async function DELETE(request: Request) {\r\n  // Handle DELETE requests\r\n}\r\n\r\nexport async function HEAD(request: Request) {\r\n  // Handle HEAD requests\r\n}\r\n\r\nexport async function OPTIONS(request: Request) {\r\n  // Handle OPTIONS requests\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"request-handling",children:"Request Handling"}),"\n",(0,t.jsx)(n.h3,{id:"reading-query-parameters",children:"Reading Query Parameters"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export async function GET(request: Request) {\r\n  const { searchParams } = new URL(request.url)\r\n  const name = searchParams.get('name')\r\n  const age = searchParams.get('age')\r\n  \r\n  return Response.json({ name, age })\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reading-request-body",children:"Reading Request Body"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export async function POST(request: Request) {\r\n  const body = await request.json()\r\n  // body contains parsed JSON\r\n  \r\n  return Response.json({ received: body })\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reading-headers",children:"Reading Headers"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"import { headers } from 'next/headers'\r\n\r\nexport async function GET() {\r\n  const headersList = headers()\r\n  const authorization = headersList.get('authorization')\r\n  \r\n  return Response.json({ authorization })\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reading-cookies",children:"Reading Cookies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"import { cookies } from 'next/headers'\r\n\r\nexport async function GET() {\r\n  const cookieStore = cookies()\r\n  const token = cookieStore.get('token')\r\n  \r\n  return Response.json({ token })\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"response-handling",children:"Response Handling"}),"\n",(0,t.jsx)(n.h3,{id:"json-response",children:"JSON Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"return Response.json({ message: 'Success' })\n"})}),"\n",(0,t.jsx)(n.h3,{id:"response-with-status-code",children:"Response with Status Code"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"return Response.json(\r\n  { error: 'Not found' },\r\n  { status: 404 }\r\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"response-with-headers",children:"Response with Headers"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"return Response.json(data, {\r\n  status: 200,\r\n  headers: {\r\n    'Cache-Control': 'max-age=3600',\r\n    'Content-Type': 'application/json'\r\n  }\r\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"set-cookies",children:"Set Cookies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"import { cookies } from 'next/headers'\r\n\r\nexport async function POST() {\r\n  cookies().set('token', 'abc123', {\r\n    httpOnly: true,\r\n    secure: true,\r\n    maxAge: 60 * 60 * 24 * 7 // 1 week\r\n  })\r\n  \r\n  return Response.json({ success: true })\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export async function GET(request: Request) {\r\n  try {\r\n    const data = await fetchData()\r\n    return Response.json(data)\r\n  } catch (error) {\r\n    console.error('Error:', error)\r\n    return Response.json(\r\n      { error: 'Internal Server Error' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"import { verify } from 'jsonwebtoken'\r\n\r\nexport async function GET(request: Request) {\r\n  const authorization = request.headers.get('authorization')\r\n  \r\n  if (!authorization) {\r\n    return Response.json(\r\n      { error: 'Unauthorized' },\r\n      { status: 401 }\r\n    )\r\n  }\r\n  \r\n  try {\r\n    const token = authorization.split(' ')[1]\r\n    const decoded = verify(token, process.env.JWT_SECRET!)\r\n    \r\n    // Proceed with authenticated request\r\n    const data = await getUserData(decoded.userId)\r\n    return Response.json(data)\r\n  } catch {\r\n    return Response.json(\r\n      { error: 'Invalid token' },\r\n      { status: 401 }\r\n    )\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cors-configuration",children:"CORS Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export async function OPTIONS(request: Request) {\r\n  return new Response(null, {\r\n    status: 200,\r\n    headers: {\r\n      'Access-Control-Allow-Origin': '*',\r\n      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',\r\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    },\r\n  })\r\n}\r\n\r\nexport async function GET(request: Request) {\r\n  const data = { message: 'Hello' }\r\n  \r\n  return Response.json(data, {\r\n    headers: {\r\n      'Access-Control-Allow-Origin': '*',\r\n    },\r\n  })\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"edge-runtime",children:"Edge Runtime"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"export const runtime = 'edge'\r\n\r\nexport async function GET() {\r\n  // This runs at the edge, not on a server\r\n  return Response.json({ message: 'Hello from Edge' })\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate Input"}),": Always validate and sanitize inputs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle Errors"}),": Provide meaningful error messages"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use Status Codes"}),": Return appropriate HTTP status codes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Secure Secrets"}),": Never expose API keys or secrets"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate Limiting"}),": Implement rate limiting for public APIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use TypeScript"}),": Type your request/response data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Log Errors"}),": Log errors for debugging"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cache Responses"}),": Cache when appropriate"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"comparison",children:"Comparison"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"API Routes"}),(0,t.jsx)(n.th,{children:"Server Actions"}),(0,t.jsx)(n.th,{children:"Server Components"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Use Case"}),(0,t.jsx)(n.td,{children:"External APIs"}),(0,t.jsx)(n.td,{children:"Form mutations"}),(0,t.jsx)(n.td,{children:"Data fetching"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Complexity"}),(0,t.jsx)(n.td,{children:"Higher"}),(0,t.jsx)(n.td,{children:"Lower"}),(0,t.jsx)(n.td,{children:"Lowest"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TypeScript"}),(0,t.jsx)(n.td,{children:"Manual types"}),(0,t.jsx)(n.td,{children:"Auto-inferred"}),(0,t.jsx)(n.td,{children:"Auto-inferred"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HTTP Methods"}),(0,t.jsx)(n.td,{children:"All"}),(0,t.jsx)(n.td,{children:"POST only"}),(0,t.jsx)(n.td,{children:"None"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CORS"}),(0,t.jsx)(n.td,{children:"Configurable"}),(0,t.jsx)(n.td,{children:"Same-origin"}),(0,t.jsx)(n.td,{children:"Same-origin"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"learn-more",children:"Learn More"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/routing/route-handlers",children:"Next.js API Routes"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",children:"Web Fetch API"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);