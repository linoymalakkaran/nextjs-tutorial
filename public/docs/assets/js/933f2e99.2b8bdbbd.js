"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[677],{1827(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"data/server-actions","title":"Server Actions","description":"Purpose","source":"@site/docs/data/server-actions.md","sourceDirName":"data","slug":"/data/server-actions","permalink":"/docs/data/server-actions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Server Actions"},"sidebar":"tutorialSidebar","previous":{"title":"Streaming & Suspense","permalink":"/docs/rendering/streaming-suspense"},"next":{"title":"API Routes","permalink":"/docs/data/api-routes"}}');var s=r(2540),i=r(3023);const a={title:"Server Actions"},o="Server Actions",l={},d=[{value:"Purpose",id:"purpose",level:2},{value:"Why Use Server Actions?",id:"why-use-server-actions",level:2},{value:"Benefits",id:"benefits",level:3},{value:"When to Use",id:"when-to-use",level:2},{value:"\u2705 Use Server Actions For:",id:"-use-server-actions-for",level:3},{value:"\u274c Don&#39;t Use Server Actions For:",id:"-dont-use-server-actions-for",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"1. Contact Form",id:"1-contact-form",level:3},{value:"2. Todo List (Create/Update/Delete)",id:"2-todo-list-createupdatedelete",level:3},{value:"3. User Settings Update",id:"3-user-settings-update",level:3},{value:"Key Features",id:"key-features",level:2},{value:"The &#39;use server&#39; Directive",id:"the-use-server-directive",level:3},{value:"Progressive Enhancement",id:"progressive-enhancement",level:3},{value:"Automatic Revalidation",id:"automatic-revalidation",level:3},{value:"Form Handling Patterns",id:"form-handling-patterns",level:2},{value:"1. With useFormState (Next.js 14+)",id:"1-with-useformstate-nextjs-14",level:3},{value:"2. With useFormStatus",id:"2-with-useformstatus",level:3},{value:"3. With useTransition",id:"3-with-usetransition",level:3},{value:"Validation &amp; Error Handling",id:"validation--error-handling",level:2},{value:"With Zod",id:"with-zod",level:3},{value:"Comparison",id:"comparison",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Input Validation",id:"input-validation",level:3},{value:"Learn More",id:"learn-more",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"server-actions",children:"Server Actions"})}),"\n",(0,s.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,s.jsx)(n.p,{children:"Server Actions are asynchronous server-side functions that can be called directly from Client Components. They eliminate the need for creating API routes for simple form submissions and data mutations."}),"\n",(0,s.jsx)(n.h2,{id:"why-use-server-actions",children:"Why Use Server Actions?"}),"\n",(0,s.jsx)(n.h3,{id:"benefits",children:"Benefits"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"No API Routes Needed"}),": Call server functions directly from components"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Progressive Enhancement"}),": Forms work without JavaScript"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automatic Serialization"}),": Data is automatically serialized/deserialized"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type-Safe"}),": Full TypeScript support with type inference"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Built-in Revalidation"}),": Easily revalidate cached data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Secure"}),": Server code never exposed to client"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use",children:"When to Use"}),"\n",(0,s.jsx)(n.h3,{id:"-use-server-actions-for",children:"\u2705 Use Server Actions For:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Form Submissions"}),": Contact forms, sign-up forms, settings"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Mutations"}),": Create, update, delete operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"File Uploads"}),": Handle file uploads securely"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database Operations"}),": Insert, update, delete records"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Revalidation"}),": Trigger cache revalidation after mutations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Protected Operations"}),": Operations requiring authentication"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-dont-use-server-actions-for",children:"\u274c Don't Use Server Actions For:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Fetching"}),": Use Server Components or TanStack Query instead"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Real-time Updates"}),": Use WebSockets or polling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Complex APIs"}),": Use API routes for REST/GraphQL APIs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"External Integrations"}),": Use API routes for better control"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsx)(n.h3,{id:"1-contact-form",children:"1. Contact Form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// actions.ts\r\n\'use server\'\r\n\r\nexport async function submitContactForm(formData: FormData) {\r\n  const email = formData.get(\'email\')\r\n  const message = formData.get(\'message\')\r\n  \r\n  await sendEmail({ email, message })\r\n  return { success: true }\r\n}\r\n\r\n// ContactForm.tsx\r\n<form action={submitContactForm}>\r\n  <input name="email" type="email" required />\r\n  <textarea name="message" required />\r\n  <button type="submit">Send</button>\r\n</form>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-todo-list-createupdatedelete",children:"2. Todo List (Create/Update/Delete)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nexport async function addTodo(formData: FormData) {\r\n  const title = formData.get('title')\r\n  await db.todo.create({ data: { title } })\r\n  revalidatePath('/todos')\r\n}\r\n\r\nexport async function toggleTodo(id: string) {\r\n  await db.todo.update({\r\n    where: { id },\r\n    data: { completed: { not: true } }\r\n  })\r\n  revalidatePath('/todos')\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-user-settings-update",children:"3. User Settings Update"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server'\r\n\r\nexport async function updateSettings(userId: string, data: Settings) {\r\n  await db.user.update({\r\n    where: { id: userId },\r\n    data\r\n  })\r\n  revalidatePath('/settings')\r\n  return { success: true }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,s.jsx)(n.h3,{id:"the-use-server-directive",children:"The 'use server' Directive"}),"\n",(0,s.jsx)(n.p,{children:"Mark functions as Server Actions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server' // At top of file - all exports are Server Actions\r\n\r\nexport async function myAction() {\r\n  // Server-side code\r\n}\r\n\r\n// Or inline:\r\nexport default function Component() {\r\n  async function myAction() {\r\n    'use server' // Inline Server Action\r\n    // Server-side code\r\n  }\r\n  return <form action={myAction}>...</form>\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"progressive-enhancement",children:"Progressive Enhancement"}),"\n",(0,s.jsx)(n.p,{children:"Forms work without JavaScript:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// This form works even if JS is disabled!\r\n<form action={serverAction}>\r\n  <input name="email" />\r\n  <button type="submit">Submit</button>\r\n</form>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"automatic-revalidation",children:"Automatic Revalidation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server'\r\nimport { revalidatePath, revalidateTag } from 'next/cache'\r\n\r\nexport async function updatePost(id: string, data: Post) {\r\n  await db.post.update({ where: { id }, data })\r\n  \r\n  // Revalidate specific path\r\n  revalidatePath('/posts')\r\n  \r\n  // Or revalidate by tag\r\n  revalidateTag('posts')\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"form-handling-patterns",children:"Form Handling Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"1-with-useformstate-nextjs-14",children:"1. With useFormState (Next.js 14+)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use client'\r\nimport { useFormState } from 'react-dom'\r\nimport { submitForm } from './actions'\r\n\r\nexport default function Form() {\r\n  const [state, formAction] = useFormState(submitForm, { message: '' })\r\n  \r\n  return (\r\n    <form action={formAction}>\r\n      <input name=\"email\" />\r\n      <button type=\"submit\">Submit</button>\r\n      {state.message && <p>{state.message}</p>}\r\n    </form>\r\n  )\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-with-useformstatus",children:"2. With useFormStatus"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use client'\r\nimport { useFormStatus } from 'react-dom'\r\n\r\nfunction SubmitButton() {\r\n  const { pending } = useFormStatus()\r\n  \r\n  return (\r\n    <button type=\"submit\" disabled={pending}>\r\n      {pending ? 'Submitting...' : 'Submit'}\r\n    </button>\r\n  )\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-with-usetransition",children:"3. With useTransition"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use client'\r\nimport { useTransition } from 'react'\r\nimport { deletePost } from './actions'\r\n\r\nexport default function DeleteButton({ id }) {\r\n  const [isPending, startTransition] = useTransition()\r\n  \r\n  return (\r\n    <button\r\n      onClick={() => startTransition(() => deletePost(id))}\r\n      disabled={isPending}\r\n    >\r\n      {isPending ? 'Deleting...' : 'Delete'}\r\n    </button>\r\n  )\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"validation--error-handling",children:"Validation & Error Handling"}),"\n",(0,s.jsx)(n.h3,{id:"with-zod",children:"With Zod"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server'\r\nimport { z } from 'zod'\r\n\r\nconst schema = z.object({\r\n  email: z.string().email(),\r\n  password: z.string().min(8)\r\n})\r\n\r\nexport async function register(formData: FormData) {\r\n  const data = {\r\n    email: formData.get('email'),\r\n    password: formData.get('password')\r\n  }\r\n  \r\n  const result = schema.safeParse(data)\r\n  if (!result.success) {\r\n    return { errors: result.error.flatten().fieldErrors }\r\n  }\r\n  \r\n  await createUser(result.data)\r\n  return { success: true }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"comparison",children:"Comparison"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"Server Actions"}),(0,s.jsx)(n.th,{children:"API Routes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Boilerplate"}),(0,s.jsx)(n.td,{children:"\u2705 Minimal"}),(0,s.jsx)(n.td,{children:"\u274c More code"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Type Safety"}),(0,s.jsx)(n.td,{children:"\u2705 Excellent"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Manual"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Forms"}),(0,s.jsx)(n.td,{children:"\u2705 Direct integration"}),(0,s.jsx)(n.td,{children:"\u274c Manual fetch"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Progressive Enhancement"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"\u274c Requires JS"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Revalidation"}),(0,s.jsx)(n.td,{children:"\u2705 Built-in"}),(0,s.jsx)(n.td,{children:"\u274c Manual"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Complex APIs"}),(0,s.jsx)(n.td,{children:"\u274c Limited"}),(0,s.jsx)(n.td,{children:"\u2705 Full control"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Always Validate"}),": Never trust client data, validate on server"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use FormData"}),": Leverage native FormData API"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Handle Errors"}),": Return error states, don't throw"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Revalidate"}),": Update cache after mutations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Keep Functions Small"}),": One responsibility per action"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use TypeScript"}),": Get full type safety"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authentication"}),": Check auth in every action"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rate Limiting"}),": Implement rate limiting for public actions"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server'\r\nimport { auth } from '@/lib/auth'\r\n\r\nexport async function deletePost(id: string) {\r\n  const user = await auth()\r\n  if (!user) throw new Error('Unauthorized')\r\n  \r\n  await db.post.delete({ where: { id, userId: user.id } })\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"input-validation",children:"Input Validation"}),"\n",(0,s.jsx)(n.p,{children:"Always validate and sanitize inputs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"'use server'\r\n\r\nexport async function createPost(formData: FormData) {\r\n  const title = formData.get('title')\r\n  \r\n  if (!title || typeof title !== 'string') {\r\n    return { error: 'Invalid title' }\r\n  }\r\n  \r\n  if (title.length < 3 || title.length > 100) {\r\n    return { error: 'Title must be 3-100 characters' }\r\n  }\r\n  \r\n  await db.post.create({ data: { title } })\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"learn-more",children:"Learn More"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations",children:"Next.js Server Actions Docs"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://react.dev/reference/react/use-server",children:"React Server Functions"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},3023(e,n,r){r.d(n,{R:()=>a,x:()=>o});var t=r(3696);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);